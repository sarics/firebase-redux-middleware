{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4da318358525c1ebe58c","webpack:///./src/utils/isEqual.js","webpack:///./src/utils/getDeepData.js","webpack:///./src/utils/getDifference.js","webpack:///./src/utils/snapshotToArray.js","webpack:///./src/utils/addIdToActionData.js","webpack:///./src/index.js"],"names":["isEqual","obj1","obj2","Array","isArray","Object","keys","reduce","isEq","key","getDeepData","data","path","length","slice","test","parseInt","oldData","newData","changes","item","newChanges","assign","oldItem","find","id","newItem","removed","filter","edited","concat","added","snapshot","list","forEach","childSnapshot","push","val","addIdToActionData","action","found","shouldCheck","actionData","map","newAction","DB_ACTION_KEY","logError","args","error","createFbMiddleware","config","pathOptsArr","firebase","reducer","privatePath","authActions","onInited","auth","database","publicPathOpts","isPrivate","privatePathOpts","inited","currentUser","unsubscribeFns","getRefForPath","fbPath","ref","uid","getStateForPath","state","storePath","split","findItemByIdForPath","pathOpts","dbAction","setupPath","store","actions","initState","getState","Promise","resolve","onceValue","snapshotToArray","dispatch","set","findItem","ss","onChildAdded","add","onChildChanged","edit","onChildRemoved","remove","on","off","unset","onValue","value","newValue","once","then","setupPaths","paths","all","cleanupPaths","usFn","next","setupPublicPaths","initSetupPaths","onAuthStateChanged","user","toJSON","setupPrivatePaths","undefined","prototype","hasOwnProperty","call","dbJobs","oldState","newState","getDifference","method","child","result"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;AC7DA,IAAMA,UAAU,SAAVA,OAAU,CAACC,IAAD,EAAOC,IAAP,EAAgB;AAC9B,MACED,QAAQ,IAAR,IACAC,QAAQ,IADR,IAEA,QAAOD,IAAP,yCAAOA,IAAP,OAAgB,QAFhB,IAGA,QAAOC,IAAP,yCAAOA,IAAP,OAAgB,QAJlB,EAKE,OAAOD,SAASC,IAAhB;;AAEF,MAAIC,MAAMC,OAAN,CAAcH,IAAd,MAAwBE,MAAMC,OAAN,CAAcF,IAAd,CAA5B,EAAiD,OAAO,KAAP;;AAEjD,SAAOG,OAAOC,IAAP,CAAYL,IAAZ,EAAkBM,MAAlB,CAAyB,UAACC,IAAD,EAAOC,GAAP;AAAA,WAAeD,QAAQR,QAAQC,KAAKQ,GAAL,CAAR,EAAmBP,KAAKO,GAAL,CAAnB,CAAvB;AAAA,GAAzB,EAA+E,IAA/E,CAAP;AACD,CAXD;;AAaA,kDAAeT,OAAf,E;;;;ACbA,IAAMU,cAAc,SAAdA,WAAc,CAACC,IAAD,EAAqB;AAAA,MAAdC,IAAc,uEAAP,EAAO;;AACvC,MAAID,QAAQ,IAAR,IAAgB,QAAOA,IAAP,qDAAOA,IAAP,OAAgB,QAAhC,IAA4C,CAACC,KAAKC,MAAtD,EAA8D,OAAOF,IAAP;;AAE9D,MAAIF,MAAMG,KAAKE,KAAL,CAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAAV;AACA,MAAI,QAAQC,IAAR,CAAaN,GAAb,CAAJ,EAAuBA,MAAMO,SAASP,GAAT,EAAc,EAAd,CAAN;;AAEvB,SAAOC,YAAYC,KAAKF,GAAL,CAAZ,EAAuBG,KAAKE,KAAL,CAAW,CAAX,CAAvB,CAAP;AACD,CAPD;;AASA,sDAAeJ,WAAf,E;;ACTA;;AAEA,kDAAe,UAACO,OAAD,EAAUC,OAAV;AAAA,SACbA,QAAQX,MAAR,CAAe,UAACY,OAAD,EAAUC,IAAV,EAAmB;AAChC,QAAMC,aAAahB,OAAOiB,MAAP,CAAc,EAAd,EAAkBH,OAAlB,CAAnB;;AAEA,QAAMI,UAAUN,QAAQO,IAAR,CAAa;AAAA,UAAGC,EAAH,QAAGA,EAAH;AAAA,aAAYA,OAAOL,KAAKK,EAAxB;AAAA,KAAb,CAAhB;AACA,QAAMC,UAAUrB,OAAOiB,MAAP,CAAc,EAAd,EAAkBF,IAAlB,CAAhB;;AAEA,QAAIG,OAAJ,EAAa;AACXF,iBAAWM,OAAX,GAAqBN,WAAWM,OAAX,CAAmBC,MAAnB,CAA0B;AAAA,YAAGH,EAAH,SAAGA,EAAH;AAAA,eAAYA,OAAOF,QAAQE,EAA3B;AAAA,OAA1B,CAArB;;AAEA,UAAI,CAAC,aAAAzB,CAAQuB,OAAR,EAAiBG,OAAjB,CAAL,EAAgCL,WAAWQ,MAAX,GAAoBR,WAAWQ,MAAX,CAAkBC,MAAlB,CAAyB,CAACJ,OAAD,CAAzB,CAApB;AACjC,KAJD,MAIO;AACLL,iBAAWU,KAAX,GAAmBV,WAAWU,KAAX,CAAiBD,MAAjB,CAAwB,CAACJ,OAAD,CAAxB,CAAnB;AACD;;AAED,WAAOL,UAAP;AACD,GAfD,EAeG;AACDU,WAAO,EADN;AAEDF,YAAQ,EAFP;AAGDF,aAASV,QAAQH,KAAR;AAHR,GAfH,CADa;AAAA,CAAf,E;;;;ACFA,oDAAe,UAACkB,QAAD,EAAc;AAC3B,MAAMC,OAAO,EAAb;;AAEAD,WAASE,OAAT,CAAiB,UAACC,aAAD,EAAmB;AAClCF,SAAKG,IAAL;AACEX,UAAIU,cAAc1B;AADpB,OAEK0B,cAAcE,GAAd,EAFL;AAID,GALD;;AAOA,SAAOJ,IAAP;AACD,CAXD,E;;;;;;;;ACAA;;AAEA,IAAM,mCAAAK,GAAoB,SAApBA,iBAAoB,CAACC,MAAD,EAAS5B,IAAT,EAAec,EAAf,EAAsB;AAC9C,MAAIe,QAAQ,KAAZ;;AAEA,MAAMC,cAAc,SAAdA,WAAc,CAACC,UAAD;AAAA,WAClB,CAACF,KAAD,IAAUE,cAAc,IAAxB,IAAgC,QAAOA,UAAP,2DAAOA,UAAP,OAAsB,QADpC;AAAA,GAApB;;AAGA,MAAIvC,MAAMC,OAAN,CAAcmC,MAAd,CAAJ,EAA2B;AACzB,WAAOA,OAAOI,GAAP,CAAW,UAACD,UAAD,EAAgB;AAChC,UAAI,CAACF,KAAD,IAAU,aAAAxC,CAAQ0C,UAAR,EAAoB/B,IAApB,CAAd,EAAyC;AACvC6B,gBAAQ,IAAR;;AAEA;AACEf;AADF,WAEKd,IAFL;AAID;AACD,UAAI8B,YAAYC,UAAZ,CAAJ,EAA6B;AAC3B,eAAOJ,kBAAkBI,UAAlB,EAA8B/B,IAA9B,EAAoCc,EAApC,CAAP;AACD;AACD,aAAOiB,UAAP;AACD,KAbM,CAAP;AAcD;;AAED,SAAOrC,OAAOC,IAAP,CAAYiC,MAAZ,EAAoBhC,MAApB,CAA2B,UAACqC,SAAD,EAAYnC,GAAZ,EAAoB;AACpD,QAAMiC,aAAaH,OAAO9B,GAAP,CAAnB;;AAEA,QAAI,CAAC+B,KAAD,IAAU,aAAAxC,CAAQ0C,UAAR,EAAoB/B,IAApB,CAAd,EAAyC;AACvC6B,cAAQ,IAAR;;AAEA,4CACKI,SADL,sBAEGnC,GAFH;AAGIgB;AAHJ,SAIOd,IAJP;AAOD;AACD,QAAI8B,YAAYC,UAAZ,CAAJ,EAA6B;AAC3B,4CACKE,SADL,sBAEGnC,GAFH,EAES6B,kBAAkBI,UAAlB,EAA8B/B,IAA9B,EAAoCc,EAApC,CAFT;AAID;AACD,0CACKmB,SADL,sBAEGnC,GAFH,EAESiC,UAFT;AAID,GAxBM,EAwBJ,EAxBI,CAAP;AAyBD,CAhDD;;AAkDA,4DAAe,mCAAf,E;;;;;;;;;;;ACpDA;AACA;AACA;AACA;AACA;;AAGA,IAAMG,gBAAgB,eAAtB;;AAEA,IAAMC,WAAW,SAAXA,QAAW,GAAa;AAAA;;AAAA,oCAATC,IAAS;AAATA,QAAS;AAAA;;AAC5B,uBAAQC,KAAR,kBAAc,uBAAd,SAA0CD,IAA1C,GAD4B,CACqB;AAClD,CAFD;;AAKA;AACO,IAAM,sBAAAE,GAAqB,SAArBA,kBAAqB,CAACC,MAAD,EAASC,WAAT,EAAyB;AAAA,MAEvDC,QAFuD,GAOrDF,MAPqD,CAEvDE,QAFuD;AAAA,MAGvDC,OAHuD,GAOrDH,MAPqD,CAGvDG,OAHuD;AAAA,MAIvDC,WAJuD,GAOrDJ,MAPqD,CAIvDI,WAJuD;AAAA,4BAOrDJ,MAPqD,CAKvDK,WALuD;AAAA,MAKvDA,WALuD,uCAKzC,EALyC;AAAA,yBAOrDL,MAPqD,CAMvDM,QANuD;AAAA,MAMvDA,QANuD,oCAM5C,YAAM,CAAE,CANoC;;;AASzD,MAAMC,OAAOL,SAASK,IAAT,EAAb;AACA,MAAMC,WAAWN,SAASM,QAAT,EAAjB;;AAEA,MAAMC,iBAAiBR,YAAYvB,MAAZ,CAAmB;AAAA,QAAGgC,SAAH,QAAGA,SAAH;AAAA,WAAmB,CAACA,SAApB;AAAA,GAAnB,CAAvB;AACA,MAAMC,kBAAkBV,YAAYvB,MAAZ,CAAmB;AAAA,QAAGgC,SAAH,SAAGA,SAAH;AAAA,WAAmBA,SAAnB;AAAA,GAAnB,CAAxB;;AAEA,MAAIE,SAAS,KAAb;AACA,MAAIC,oBAAJ;AACA,MAAIC,iBAAiB,EAArB;;AAEA,MAAMC,gBAAgB,SAAhBA,aAAgB,QAA2B;AAAA,QAAxBC,MAAwB,SAAxBA,MAAwB;AAAA,QAAhBN,SAAgB,SAAhBA,SAAgB;;AAC/C,QAAI,CAACA,SAAL,EAAgB,OAAOF,SAASS,GAAT,CAAaD,MAAb,CAAP;AAChB,QAAI,CAACH,WAAL,EAAkB,OAAO,IAAP;AAClB,WAAOL,SAASS,GAAT,CAAgBb,WAAhB,SAA+BS,YAAYK,GAA3C,SAAkDF,MAAlD,CAAP;AACD,GAJD;;AAMA,MAAMG,kBAAkB,SAAlBA,eAAkB,CAACC,KAAD;AAAA,QAAUC,SAAV,SAAUA,SAAV;AAAA,WACtB,iBAAA7D,CAAY4D,KAAZ,EAAmBC,UAAUC,KAAV,CAAgB,GAAhB,CAAnB,CADsB;AAAA,GAAxB;;AAGA,MAAMC,sBAAsB,SAAtBA,mBAAsB,CAACH,KAAD,EAAQI,QAAR,EAAkBjD,EAAlB;AAAA,WAC1B4C,gBAAgBC,KAAhB,EAAuBI,QAAvB,EAAiClD,IAAjC,CAAsC,UAACJ,IAAD;AAAA,aAAUA,KAAKK,EAAL,KAAYA,EAAtB;AAAA,KAAtC,CAD0B;AAAA,GAA5B;;AAGA,MAAMkD,WAAW,SAAXA,QAAW,CAACpC,MAAD,EAAS5B,IAAT;AAAA,4BACZ4B,OAAO5B,IAAP,CADY,0BAEdkC,aAFc,EAEE,IAFF;AAAA,GAAjB;;AAKA,MAAM+B,YAAY,SAAZA,SAAY,CAACF,QAAD,EAAWG,KAAX,EAAqB;AAAA,QAC7BjB,SAD6B,GACNc,QADM,CAC7Bd,SAD6B;AAAA,QAClBkB,OADkB,GACNJ,QADM,CAClBI,OADkB;;AAErC,QAAMX,MAAMF,cAAcS,QAAd,CAAZ;;AAEA,QAAMK,YAAYV,gBAAgBQ,MAAMG,QAAN,EAAhB,EAAkCN,QAAlC,CAAlB;AACA,QAAI,CAACK,SAAD,IAAc,QAAOA,SAAP,6CAAOA,SAAP,OAAqB,QAAvC,EAAiD;AAC/CjC,eAAS,8CAAT,EAAyD4B,QAAzD;AACA,aAAOO,QAAQC,OAAR,CAAgBH,SAAhB,CAAP;AACD;;AAED,QAAMI,YAAY,SAAZA,SAAY,CAACnD,QAAD,EAAc;AAC9B,UAAIrB,aAAJ;;AAEA,UAAIR,MAAMC,OAAN,CAAc2E,SAAd,CAAJ,EAA8B;AAC5BpE,eAAO,eAAAyE,CAAgBpD,QAAhB,CAAP;AACA,YAAIrB,KAAKE,MAAT,EAAiBgE,MAAMQ,QAAN,CAAeV,SAASG,QAAQQ,GAAjB,EAAsB3E,IAAtB,CAAf;;AAEjB,YAAM4E,WAAW,SAAXA,QAAW,CAACC,EAAD;AAAA,iBAAQf,oBAAoBI,MAAMG,QAAN,EAApB,EAAsCN,QAAtC,EAAgDc,GAAG/E,GAAnD,CAAR;AAAA,SAAjB;;AAEA,YAAMgF,eAAe,SAAfA,YAAe,CAACD,EAAD,EAAQ;AAC3B,cAAMpE,OAAOmE,SAASC,EAAT,CAAb;AACA,cAAI,CAACpE,IAAL,EAAWyD,MAAMQ,QAAN,CAAeV,SAASG,QAAQY,GAAjB,iBAAwBjE,IAAI+D,GAAG/E,GAA/B,IAAuC+E,GAAGnD,GAAH,EAAvC,EAAf;AACZ,SAHD;;AAKA,YAAMsD,iBAAiB,SAAjBA,cAAiB,CAACH,EAAD,EAAQ;AAC7B,cAAMpE,OAAOmE,SAASC,EAAT,CAAb;AACA,cAAM9D,UAAA,YAAAA,GAAYD,IAAI+D,GAAG/E,GAAnB,IAA2B+E,GAAGnD,GAAH,EAA3B,CAAN;AACA,cAAI,CAAC,aAAArC,CAAQoB,IAAR,EAAcM,OAAd,CAAL,EAA6BmD,MAAMQ,QAAN,CAAeV,SAASG,QAAQc,IAAjB,EAAuBlE,OAAvB,CAAf;AAC9B,SAJD;;AAMA,YAAMmE,iBAAiB,SAAjBA,cAAiB,CAACL,EAAD,EAAQ;AAC7B,cAAMpE,OAAOmE,SAASC,EAAT,CAAb;AACA,cAAIpE,IAAJ,EAAUyD,MAAMQ,QAAN,CAAeV,SAASG,QAAQgB,MAAjB,EAAyB,EAAErE,IAAI+D,GAAG/E,GAAT,EAAzB,CAAf;AACX,SAHD;;AAKA0D,YAAI4B,EAAJ,CAAO,aAAP,EAAsBN,YAAtB;AACAtB,YAAI4B,EAAJ,CAAO,eAAP,EAAwBJ,cAAxB;AACAxB,YAAI4B,EAAJ,CAAO,eAAP,EAAwBF,cAAxB;;AAEA,YAAIjC,SAAJ,EAAe;AACbI,yBAAe5B,IAAf,CAAoB,YAAM;AACxB+B,gBAAI6B,GAAJ,CAAQ,aAAR,EAAuBP,YAAvB;AACAtB,gBAAI6B,GAAJ,CAAQ,eAAR,EAAyBL,cAAzB;AACAxB,gBAAI6B,GAAJ,CAAQ,eAAR,EAAyBH,cAAzB;;AAEAhB,kBAAMQ,QAAN,CAAeV,SAASG,QAAQmB,KAAjB,CAAf;AACD,WAND;AAOD;AACF,OAnCD,MAmCO;AACLtF,eAAOqB,SAASK,GAAT,EAAP;AACA,YAAI1B,IAAJ,EAAUkE,MAAMQ,QAAN,CAAeV,SAASG,QAAQQ,GAAjB,EAAsB3E,IAAtB,CAAf;;AAEV,YAAMuF,UAAU,SAAVA,OAAU,CAACV,EAAD,EAAQ;AACtB,cAAMW,QAAQ9B,gBAAgBQ,MAAMG,QAAN,EAAhB,EAAkCN,QAAlC,CAAd;AACA,cAAM0B,WAAWZ,GAAGnD,GAAH,MAAY,EAA7B;AACA,cAAI,CAAC,aAAArC,CAAQmG,KAAR,EAAeC,QAAf,CAAL,EAA+BvB,MAAMQ,QAAN,CAAeV,SAASG,QAAQQ,GAAjB,EAAsBc,QAAtB,CAAf;AAChC,SAJD;;AAMAjC,YAAI4B,EAAJ,CAAO,OAAP,EAAgBG,OAAhB;;AAEA,YAAItC,SAAJ,EAAe;AACbI,yBAAe5B,IAAf,CAAoB,YAAM;AACxB+B,gBAAI6B,GAAJ,CAAQ,OAAR,EAAiBE,OAAjB;;AAEArB,kBAAMQ,QAAN,CAAeV,SAASG,QAAQmB,KAAjB,CAAf;AACD,WAJD;AAKD;AACF;;AAED,aAAOtF,IAAP;AACD,KA5DD;;AA8DA,WAAOwD,IAAIkC,IAAJ,CAAS,OAAT,EACJC,IADI,CACCnB,SADD,CAAP;AAED,GA1ED;;AA4EA,MAAMoB,aAAa,SAAbA,UAAa,CAACC,KAAD,EAAQ3B,KAAR;AAAA,WACjBI,QAAQwB,GAAR,CAAYD,MAAM7D,GAAN,CAAU,UAAC+B,QAAD;AAAA,aAAcE,UAAUF,QAAV,EAAoBG,KAApB,CAAd;AAAA,KAAV,CAAZ,CADiB;AAAA,GAAnB;;AAGA,MAAM6B,eAAe,SAAfA,YAAe,GAAM;AACzB1C,mBAAe9B,OAAf,CAAuB,UAACyE,IAAD;AAAA,aAAUA,MAAV;AAAA,KAAvB;AACA3C,qBAAiB,EAAjB;AACD,GAHD;;AAKA,SAAO,UAACa,KAAD;AAAA,WAAW,UAAC+B,IAAD,EAAU;AAC1B,UAAMC,mBAAmBN,WAAW5C,cAAX,EAA2BkB,KAA3B,CAAzB;AACA,UAAMiC,iBAAiB,CACrBD,gBADqB,CAAvB;;AAIApD,WAAKsD,kBAAL,CAAwB,UAACC,IAAD,EAAU;AAChC,YAAIA,IAAJ,EAAU;AACRjD,wBAAciD,IAAd;AACA,cAAIzD,YAAY+B,GAAhB,EAAqBT,MAAMQ,QAAN,CAAe9B,YAAY+B,GAAZ,CAAgB0B,KAAKC,MAAL,EAAhB,CAAf;;AAErB,cAAMC,oBAAoBX,WAAW1C,eAAX,EAA4BgB,KAA5B,CAA1B;AACA,cAAI,CAACf,MAAL,EAAagD,eAAe1E,IAAf,CAAoB8E,iBAApB;AACd,SAND,MAMO;AACLnD,wBAAcoD,SAAd;AACA,cAAI5D,YAAY0C,KAAhB,EAAuBpB,MAAMQ,QAAN,CAAe9B,YAAY0C,KAAZ,EAAf;;AAEvBS;AACD;;AAED,YAAI,CAAC5C,MAAL,EAAa;AACXA,mBAAS,IAAT;AACAmB,kBAAQwB,GAAR,CAAYK,cAAZ,EAA4BR,IAA5B,CAAiC;AAAA,mBAAM9C,UAAN;AAAA,WAAjC;AACD;AACF,OAlBD;;AAoBA,aAAO,UAACjB,MAAD,EAAY;AACjB,YAAIlC,OAAO+G,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC/E,MAArC,EAA6CM,aAA7C,CAAJ,EAAiE,OAAO+D,KAAKrE,MAAL,CAAP;;AAEjE,YAAIK,kBAAJ;AACA,YAAM2E,SAAS,EAAf;AACA,YAAMC,WAAW3C,MAAMG,QAAN,EAAjB;AACA,YAAMyC,WAAWpE,QAAQmE,QAAR,EAAkBjF,MAAlB,CAAjB;;AAEAY,oBAAYjB,OAAZ,CAAoB,UAACwC,QAAD,EAAc;AAChC,cAAMzD,UAAUoD,gBAAgBmD,QAAhB,EAA0B9C,QAA1B,CAAhB;AACA,cAAI,CAACzD,OAAL,EAAc;;AAEd,cAAMC,UAAUmD,gBAAgBoD,QAAhB,EAA0B/C,QAA1B,CAAhB;;AAEA,cAAIvE,MAAMC,OAAN,CAAca,OAAd,CAAJ,EAA4B;AAAA,iCACS,aAAAyG,CAAczG,OAAd,EAAuBC,OAAvB,CADT;AAAA,gBAClBa,KADkB,kBAClBA,KADkB;AAAA,gBACXF,MADW,kBACXA,MADW;AAAA,gBACHF,OADG,kBACHA,OADG;;AAG1BI,kBAAMG,OAAN,CAAc,UAACvB,IAAD,EAAU;AACtB,kBAAMwD,MAAMF,cAAcS,QAAd,EAAwBtC,IAAxB,EAAZ;;AAEAQ,0BAAY,uBAAAN,CAAkBM,aAAaL,MAA/B,EAAuC5B,IAAvC,EAA6CwD,IAAI1D,GAAjD,CAAZ;AACA8G,qBAAOnF,IAAP,CAAY;AACV+B,wBADU;AAEVwD,wBAAQ,KAFE;AAGVhH;AAHU,eAAZ;AAKD,aATD;;AAWAkB,mBAAOK,OAAP,CAAe,iBAAqB;AAAA,kBAAlBT,EAAkB,SAAlBA,EAAkB;AAAA,kBAAXd,IAAW;;AAClC4G,qBAAOnF,IAAP,CAAY;AACV+B,qBAAKF,cAAcS,QAAd,EAAwBkD,KAAxB,CAA8BnG,EAA9B,CADK;AAEVkG,wBAAQ,QAFE;AAGVhH;AAHU,eAAZ;AAKD,aAND;;AAQAgB,oBAAQO,OAAR,CAAgB,iBAAY;AAAA,kBAATT,EAAS,SAATA,EAAS;;AAC1B8F,qBAAOnF,IAAP,CAAY;AACV+B,qBAAKF,cAAcS,QAAd,EAAwBkD,KAAxB,CAA8BnG,EAA9B,CADK;AAEVkG,wBAAQ;AAFE,eAAZ;AAID,aALD;AAMD,WA5BD,MA4BO,IAAI,CAAC,aAAA3H,CAAQiB,OAAR,EAAiBC,OAAjB,CAAL,EAAgC;AACrCqG,mBAAOnF,IAAP,CAAY;AACV+B,mBAAKF,cAAcS,QAAd,CADK;AAEViD,sBAAQ,KAFE;AAGVhH,oBAAMO;AAHI,aAAZ;AAKD;AACF,SAzCD;;AA2CA,YAAM2G,SAASjB,KAAKhE,aAAaL,MAAlB,CAAf;;AAEAgF,eAAOrF,OAAP,CAAe,iBAA2B;AAAA,cAAxBiC,GAAwB,SAAxBA,GAAwB;AAAA,cAAnBwD,MAAmB,SAAnBA,MAAmB;AAAA,cAAXhH,IAAW,SAAXA,IAAW;;AACxCwD,cAAIwD,MAAJ,EAAYhH,IAAZ;AACD,SAFD;;AAIA,eAAOkH,MAAP;AACD,OA1DD;AA2DD,KArFM;AAAA,GAAP;AAsFD,CA9MM","file":"firebase-redux-middleware.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"firebaseReduxMiddleware\"] = factory();\n\telse\n\t\troot[\"firebaseReduxMiddleware\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4da318358525c1ebe58c","const isEqual = (obj1, obj2) => {\n  if (\n    obj1 == null ||\n    obj2 == null ||\n    typeof obj1 !== 'object' ||\n    typeof obj2 !== 'object'\n  ) return obj1 === obj2;\n\n  if (Array.isArray(obj1) !== Array.isArray(obj2)) return false;\n\n  return Object.keys(obj1).reduce((isEq, key) => isEq && isEqual(obj1[key], obj2[key]), true);\n};\n\nexport default isEqual;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/isEqual.js","const getDeepData = (data, path = []) => {\n  if (data == null || typeof data !== 'object' || !path.length) return data;\n\n  let key = path.slice(0, 1)[0];\n  if (/^\\d+$/.test(key)) key = parseInt(key, 10);\n\n  return getDeepData(data[key], path.slice(1));\n};\n\nexport default getDeepData;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/getDeepData.js","import isEqual from './isEqual';\n\nexport default (oldData, newData) =>\n  newData.reduce((changes, item) => {\n    const newChanges = Object.assign({}, changes);\n\n    const oldItem = oldData.find(({ id }) => id === item.id);\n    const newItem = Object.assign({}, item);\n\n    if (oldItem) {\n      newChanges.removed = newChanges.removed.filter(({ id }) => id !== oldItem.id);\n\n      if (!isEqual(oldItem, newItem)) newChanges.edited = newChanges.edited.concat([newItem]);\n    } else {\n      newChanges.added = newChanges.added.concat([newItem]);\n    }\n\n    return newChanges;\n  }, {\n    added: [],\n    edited: [],\n    removed: oldData.slice(),\n  });\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/getDifference.js","export default (snapshot) => {\n  const list = [];\n\n  snapshot.forEach((childSnapshot) => {\n    list.push({\n      id: childSnapshot.key,\n      ...childSnapshot.val(),\n    });\n  });\n\n  return list;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/snapshotToArray.js","import isEqual from './isEqual';\n\nconst addIdToActionData = (action, data, id) => {\n  let found = false;\n\n  const shouldCheck = (actionData) =>\n    !found && actionData != null && typeof actionData === 'object';\n\n  if (Array.isArray(action)) {\n    return action.map((actionData) => {\n      if (!found && isEqual(actionData, data)) {\n        found = true;\n\n        return {\n          id,\n          ...data,\n        };\n      }\n      if (shouldCheck(actionData)) {\n        return addIdToActionData(actionData, data, id);\n      }\n      return actionData;\n    });\n  }\n\n  return Object.keys(action).reduce((newAction, key) => {\n    const actionData = action[key];\n\n    if (!found && isEqual(actionData, data)) {\n      found = true;\n\n      return {\n        ...newAction,\n        [key]: {\n          id,\n          ...data,\n        },\n      };\n    }\n    if (shouldCheck(actionData)) {\n      return {\n        ...newAction,\n        [key]: addIdToActionData(actionData, data, id),\n      };\n    }\n    return {\n      ...newAction,\n      [key]: actionData,\n    };\n  }, {});\n};\n\nexport default addIdToActionData;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/addIdToActionData.js","import isEqual from './utils/isEqual';\nimport getDeepData from './utils/getDeepData';\nimport getDifference from './utils/getDifference';\nimport snapshotToArray from './utils/snapshotToArray';\nimport addIdToActionData from './utils/addIdToActionData';\n\n\nconst DB_ACTION_KEY = '__DB_ACTION__';\n\nconst logError = (...args) => {\n  console.error('[Firebase middleware]', ...args); // eslint-disable-line no-console\n};\n\n\n// eslint-disable-next-line import/prefer-default-export\nexport const createFbMiddleware = (config, pathOptsArr) => {\n  const {\n    firebase,\n    reducer,\n    privatePath,\n    authActions = {},\n    onInited = () => {},\n  } = config;\n\n  const auth = firebase.auth();\n  const database = firebase.database();\n\n  const publicPathOpts = pathOptsArr.filter(({ isPrivate }) => !isPrivate);\n  const privatePathOpts = pathOptsArr.filter(({ isPrivate }) => isPrivate);\n\n  let inited = false;\n  let currentUser;\n  let unsubscribeFns = [];\n\n  const getRefForPath = ({ fbPath, isPrivate }) => {\n    if (!isPrivate) return database.ref(fbPath);\n    if (!currentUser) return null;\n    return database.ref(`${privatePath}/${currentUser.uid}/${fbPath}`);\n  };\n\n  const getStateForPath = (state, { storePath }) =>\n    getDeepData(state, storePath.split('/'));\n\n  const findItemByIdForPath = (state, pathOpts, id) =>\n    getStateForPath(state, pathOpts).find((item) => item.id === id);\n\n  const dbAction = (action, data) => ({\n    ...action(data),\n    [DB_ACTION_KEY]: true,\n  });\n\n  const setupPath = (pathOpts, store) => {\n    const { isPrivate, actions } = pathOpts;\n    const ref = getRefForPath(pathOpts);\n\n    const initState = getStateForPath(store.getState(), pathOpts);\n    if (!initState || typeof initState !== 'object') {\n      logError('Path skipped, because no initial state found', pathOpts);\n      return Promise.resolve(initState);\n    }\n\n    const onceValue = (snapshot) => {\n      let data;\n\n      if (Array.isArray(initState)) {\n        data = snapshotToArray(snapshot);\n        if (data.length) store.dispatch(dbAction(actions.set, data));\n\n        const findItem = (ss) => findItemByIdForPath(store.getState(), pathOpts, ss.key);\n\n        const onChildAdded = (ss) => {\n          const item = findItem(ss);\n          if (!item) store.dispatch(dbAction(actions.add, { id: ss.key, ...ss.val() }));\n        };\n\n        const onChildChanged = (ss) => {\n          const item = findItem(ss);\n          const newItem = { id: ss.key, ...ss.val() };\n          if (!isEqual(item, newItem)) store.dispatch(dbAction(actions.edit, newItem));\n        };\n\n        const onChildRemoved = (ss) => {\n          const item = findItem(ss);\n          if (item) store.dispatch(dbAction(actions.remove, { id: ss.key }));\n        };\n\n        ref.on('child_added', onChildAdded);\n        ref.on('child_changed', onChildChanged);\n        ref.on('child_removed', onChildRemoved);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('child_added', onChildAdded);\n            ref.off('child_changed', onChildChanged);\n            ref.off('child_removed', onChildRemoved);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      } else {\n        data = snapshot.val();\n        if (data) store.dispatch(dbAction(actions.set, data));\n\n        const onValue = (ss) => {\n          const value = getStateForPath(store.getState(), pathOpts);\n          const newValue = ss.val() || {};\n          if (!isEqual(value, newValue)) store.dispatch(dbAction(actions.set, newValue));\n        };\n\n        ref.on('value', onValue);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('value', onValue);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      }\n\n      return data;\n    };\n\n    return ref.once('value')\n      .then(onceValue);\n  };\n\n  const setupPaths = (paths, store) =>\n    Promise.all(paths.map((pathOpts) => setupPath(pathOpts, store)));\n\n  const cleanupPaths = () => {\n    unsubscribeFns.forEach((usFn) => usFn());\n    unsubscribeFns = [];\n  };\n\n  return (store) => (next) => {\n    const setupPublicPaths = setupPaths(publicPathOpts, store);\n    const initSetupPaths = [\n      setupPublicPaths,\n    ];\n\n    auth.onAuthStateChanged((user) => {\n      if (user) {\n        currentUser = user;\n        if (authActions.set) store.dispatch(authActions.set(user.toJSON()));\n\n        const setupPrivatePaths = setupPaths(privatePathOpts, store);\n        if (!inited) initSetupPaths.push(setupPrivatePaths);\n      } else {\n        currentUser = undefined;\n        if (authActions.unset) store.dispatch(authActions.unset());\n\n        cleanupPaths();\n      }\n\n      if (!inited) {\n        inited = true;\n        Promise.all(initSetupPaths).then(() => onInited());\n      }\n    });\n\n    return (action) => {\n      if (Object.prototype.hasOwnProperty.call(action, DB_ACTION_KEY)) return next(action);\n\n      let newAction;\n      const dbJobs = [];\n      const oldState = store.getState();\n      const newState = reducer(oldState, action);\n\n      pathOptsArr.forEach((pathOpts) => {\n        const oldData = getStateForPath(oldState, pathOpts);\n        if (!oldData) return;\n\n        const newData = getStateForPath(newState, pathOpts);\n\n        if (Array.isArray(oldData)) {\n          const { added, edited, removed } = getDifference(oldData, newData);\n\n          added.forEach((data) => {\n            const ref = getRefForPath(pathOpts).push();\n\n            newAction = addIdToActionData(newAction || action, data, ref.key);\n            dbJobs.push({\n              ref,\n              method: 'set',\n              data,\n            });\n          });\n\n          edited.forEach(({ id, ...data }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'update',\n              data,\n            });\n          });\n\n          removed.forEach(({ id }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'remove',\n            });\n          });\n        } else if (!isEqual(oldData, newData)) {\n          dbJobs.push({\n            ref: getRefForPath(pathOpts),\n            method: 'set',\n            data: newData,\n          });\n        }\n      });\n\n      const result = next(newAction || action);\n\n      dbJobs.forEach(({ ref, method, data }) => {\n        ref[method](data);\n      });\n\n      return result;\n    };\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}