{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 71a9c366e3bab78c9b8c","webpack:///./src/utils/isEqual.js","webpack:///./src/utils/getDeepData.js","webpack:///./src/utils/getDifference.js","webpack:///./src/utils/snapshotToArray.js","webpack:///./src/utils/addIdToActionData.js","webpack:///./src/index.js"],"names":["getVal","obj","valueOf","isEqual","obj1","obj2","obj1Val","obj2Val","Number","isNaN","Array","isArray","Object","keys","length","reduce","isEq","key","getDeepData","data","path","undefined","slice","childrenHaveId","arr","find","item","id","oldData","newData","Error","changes","newChanges","oldItem","newItem","removed","filter","edited","concat","added","snapshot","list","forEach","childSnapshot","push","val","extendNewAction","newAction","newActionData","assign","addIdToActionData","action","found","actionData","DB_ACTION_KEY","logError","args","error","createFbMiddleware","config","pathOptsArr","firebase","reducer","privatePath","authActions","onInited","auth","database","publicPathOpts","isPrivate","privatePathOpts","inited","currentUser","unsubscribeFns","getRefForPath","fbPath","ref","uid","getStateForPath","state","storePath","split","findItemByIdForPath","pathOpts","dbAction","setupPath","store","actions","initState","getState","Promise","resolve","onceValue","snapshotToArray","dispatch","set","findItem","ss","onChildAdded","add","onChildChanged","edit","onChildRemoved","remove","on","off","unset","onValue","value","newValue","once","then","setupPaths","paths","all","map","cleanupPaths","usFn","next","setupPublicPaths","initSetupPaths","onAuthStateChanged","user","toJSON","setupPrivatePaths","prototype","hasOwnProperty","call","dbJobs","oldState","newState","getDifference","method","child","result"],"mappings":"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","file":"firebase-redux-middleware.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"firebaseReduxMiddleware\"] = factory();\n\telse\n\t\troot[\"firebaseReduxMiddleware\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 71a9c366e3bab78c9b8c","const getVal = (obj) => (typeof obj === 'undefined' || obj === null ? obj : obj.valueOf());\n\nconst isEqual = (obj1, obj2) => {\n  const obj1Val = getVal(obj1);\n  const obj2Val = getVal(obj2);\n\n  if (obj1Val === null || obj2Val === null || typeof obj1Val !== 'object' || typeof obj2Val !== 'object') {\n    return (\n      (obj1Val === null && obj2Val === null) ||\n      (Number.isNaN(obj1Val) && Number.isNaN(obj2Val)) ||\n      obj1Val === obj2Val\n    );\n  }\n\n  return (\n    Array.isArray(obj1Val) === Array.isArray(obj2Val) &&\n    Object.keys(obj1Val).length === Object.keys(obj2Val).length &&\n    Object.keys(obj1Val)\n      .reduce((isEq, key) => isEq && isEqual(obj1Val[key], obj2Val[key]), true)\n  );\n};\n\nexport default isEqual;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/isEqual.js","const getDeepData = (data, path = []) => {\n  if (!path.length) return data;\n  if (data === null || typeof data !== 'object') return undefined;\n\n  const key = path.slice(0, 1)[0];\n\n  return getDeepData(data[key], path.slice(1));\n};\n\nexport default getDeepData;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/getDeepData.js","import isEqual from './isEqual';\n\nconst childrenHaveId = (arr) => !arr.find((item) => !item.id);\n\nexport default (oldData, newData) => {\n  if (!Array.isArray(oldData) || !Array.isArray(newData)) {\n    throw new Error('Difference checking only works with arrays');\n  }\n\n  if (!childrenHaveId(oldData) || !childrenHaveId(newData)) {\n    throw new Error('Difference checking only works with arrays of objects with id');\n  }\n\n  return newData.reduce((changes, item) => {\n    const newChanges = { ...changes };\n\n    const oldItem = oldData.find(({ id }) => id === item.id);\n    const newItem = { ...item };\n\n    if (oldItem) {\n      newChanges.removed = newChanges.removed.filter(({ id }) => id !== oldItem.id);\n\n      if (!isEqual(oldItem, newItem)) newChanges.edited = newChanges.edited.concat([newItem]);\n    } else {\n      newChanges.added = newChanges.added.concat([newItem]);\n    }\n\n    return newChanges;\n  }, {\n    added: [],\n    edited: [],\n    removed: oldData.slice(),\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/getDifference.js","export default (snapshot) => {\n  const list = [];\n\n  snapshot.forEach((childSnapshot) => {\n    list.push({\n      id: childSnapshot.key,\n      ...childSnapshot.val(),\n    });\n  });\n\n  return list;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/snapshotToArray.js","import isEqual from './isEqual';\n\nconst extendNewAction = (newAction, key, newActionData) =>\n  Object.assign(\n    Array.isArray(newAction) ? [] : {},\n    newAction,\n    { [key]: newActionData },\n  );\n\nconst addIdToActionData = (action, data, id) => {\n  if (!action || !data || !id) return action;\n\n  let found = false;\n\n  return Object.keys(action)\n    .reduce((newAction, key) => {\n      const actionData = action[key];\n      if (found || !actionData || typeof actionData !== 'object') return extendNewAction(newAction, key, actionData);\n\n      let newActionData;\n      if (isEqual(actionData, data)) {\n        found = true;\n\n        newActionData = {\n          id,\n          ...data,\n        };\n      } else {\n        newActionData = addIdToActionData(actionData, data, id);\n      }\n\n      return extendNewAction(newAction, key, newActionData);\n    }, Array.isArray(action) ? [] : {});\n};\n\nexport default addIdToActionData;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/addIdToActionData.js","import isEqual from './utils/isEqual';\nimport getDeepData from './utils/getDeepData';\nimport getDifference from './utils/getDifference';\nimport snapshotToArray from './utils/snapshotToArray';\nimport addIdToActionData from './utils/addIdToActionData';\n\n\nconst DB_ACTION_KEY = '__DB_ACTION__';\n\nconst logError = (...args) => {\n  console.error('[Firebase middleware]', ...args); // eslint-disable-line no-console\n};\n\n\n// eslint-disable-next-line import/prefer-default-export\nexport const createFbMiddleware = (config, pathOptsArr) => {\n  const {\n    firebase,\n    reducer,\n    privatePath,\n    authActions = {},\n    onInited = () => {},\n  } = config;\n\n  const auth = firebase.auth();\n  const database = firebase.database();\n\n  const publicPathOpts = pathOptsArr.filter(({ isPrivate }) => !isPrivate);\n  const privatePathOpts = pathOptsArr.filter(({ isPrivate }) => isPrivate);\n\n  let inited = false;\n  let currentUser;\n  let unsubscribeFns = [];\n\n  const getRefForPath = ({ fbPath, isPrivate }) => {\n    if (!isPrivate) return database.ref(fbPath);\n    if (!currentUser) return null;\n    return database.ref(`${privatePath}/${currentUser.uid}/${fbPath}`);\n  };\n\n  const getStateForPath = (state, { storePath }) =>\n    getDeepData(state, storePath.split('/'));\n\n  const findItemByIdForPath = (state, pathOpts, id) =>\n    getStateForPath(state, pathOpts).find((item) => item.id === id);\n\n  const dbAction = (action, data) => ({\n    ...action(data),\n    [DB_ACTION_KEY]: true,\n  });\n\n  const setupPath = (pathOpts, store) => {\n    const { isPrivate, actions } = pathOpts;\n    const ref = getRefForPath(pathOpts);\n\n    const initState = getStateForPath(store.getState(), pathOpts);\n    if (!initState || typeof initState !== 'object') {\n      logError('Path skipped, because no initial state found', pathOpts);\n      return Promise.resolve(initState);\n    }\n\n    const onceValue = (snapshot) => {\n      let data;\n\n      if (Array.isArray(initState)) {\n        data = snapshotToArray(snapshot);\n        if (data.length) store.dispatch(dbAction(actions.set, data));\n\n        const findItem = (ss) => findItemByIdForPath(store.getState(), pathOpts, ss.key);\n\n        const onChildAdded = (ss) => {\n          const item = findItem(ss);\n          if (!item) store.dispatch(dbAction(actions.add, { id: ss.key, ...ss.val() }));\n        };\n\n        const onChildChanged = (ss) => {\n          const item = findItem(ss);\n          const newItem = { id: ss.key, ...ss.val() };\n          if (!isEqual(item, newItem)) store.dispatch(dbAction(actions.edit, newItem));\n        };\n\n        const onChildRemoved = (ss) => {\n          const item = findItem(ss);\n          if (item) store.dispatch(dbAction(actions.remove, { id: ss.key }));\n        };\n\n        ref.on('child_added', onChildAdded);\n        ref.on('child_changed', onChildChanged);\n        ref.on('child_removed', onChildRemoved);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('child_added', onChildAdded);\n            ref.off('child_changed', onChildChanged);\n            ref.off('child_removed', onChildRemoved);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      } else {\n        data = snapshot.val();\n        if (data) store.dispatch(dbAction(actions.set, data));\n\n        const onValue = (ss) => {\n          const value = getStateForPath(store.getState(), pathOpts);\n          const newValue = ss.val() || {};\n          if (!isEqual(value, newValue)) store.dispatch(dbAction(actions.set, newValue));\n        };\n\n        ref.on('value', onValue);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('value', onValue);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      }\n\n      return data;\n    };\n\n    return ref.once('value')\n      .then(onceValue);\n  };\n\n  const setupPaths = (paths, store) =>\n    Promise.all(paths.map((pathOpts) => setupPath(pathOpts, store)));\n\n  const cleanupPaths = () => {\n    unsubscribeFns.forEach((usFn) => usFn());\n    unsubscribeFns = [];\n  };\n\n  return (store) => (next) => {\n    const setupPublicPaths = setupPaths(publicPathOpts, store);\n    const initSetupPaths = [\n      setupPublicPaths,\n    ];\n\n    auth.onAuthStateChanged((user) => {\n      if (user) {\n        currentUser = user;\n        if (authActions.set) store.dispatch(authActions.set(user.toJSON()));\n\n        const setupPrivatePaths = setupPaths(privatePathOpts, store);\n        if (!inited) initSetupPaths.push(setupPrivatePaths);\n      } else {\n        currentUser = undefined;\n        if (authActions.unset) store.dispatch(authActions.unset());\n\n        cleanupPaths();\n      }\n\n      if (!inited) {\n        inited = true;\n        Promise.all(initSetupPaths).then(() => onInited());\n      }\n    });\n\n    return (action) => {\n      if (Object.prototype.hasOwnProperty.call(action, DB_ACTION_KEY)) return next(action);\n\n      let newAction;\n      const dbJobs = [];\n      const oldState = store.getState();\n      const newState = reducer(oldState, action);\n\n      pathOptsArr.forEach((pathOpts) => {\n        const oldData = getStateForPath(oldState, pathOpts);\n        if (!oldData) return;\n\n        const newData = getStateForPath(newState, pathOpts);\n\n        if (Array.isArray(oldData)) {\n          const { added, edited, removed } = getDifference(oldData, newData);\n\n          added.forEach((data) => {\n            const ref = getRefForPath(pathOpts).push();\n\n            newAction = addIdToActionData(newAction || action, data, ref.key);\n            dbJobs.push({\n              ref,\n              method: 'set',\n              data,\n            });\n          });\n\n          edited.forEach(({ id, ...data }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'update',\n              data,\n            });\n          });\n\n          removed.forEach(({ id }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'remove',\n            });\n          });\n        } else if (!isEqual(oldData, newData)) {\n          dbJobs.push({\n            ref: getRefForPath(pathOpts),\n            method: 'set',\n            data: newData,\n          });\n        }\n      });\n\n      const result = next(newAction || action);\n\n      dbJobs.forEach(({ ref, method, data }) => {\n        ref[method](data);\n      });\n\n      return result;\n    };\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}