{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2f789b07382e1f104cae","webpack:///./src/index.js"],"names":["DB_ACTION_KEY","logError","args","error","isEqual","obj1","obj2","Array","isArray","Object","keys","reduce","isEq","key","getDeepData","data","path","length","slice","test","parseInt","parseSnapshot","snapshot","list","forEach","childSnapshot","push","id","val","getDifference","oldData","newData","changes","item","newChanges","assign","oldItem","find","newItem","removed","filter","edited","concat","added","addIdToActionData","action","found","map","actionData","newAction","config","pathOptsArr","firebase","reducer","privatePath","authActions","onInited","auth","database","publicPathOpts","isPrivate","privatePathOpts","inited","currentUser","unsubscribeFns","getRefForPath","fbPath","ref","uid","getStateForPath","state","storePath","split","findItemByIdForPath","pathOpts","dbAction","setupPath","store","actions","initState","getState","Promise","resolve","onceValue","dispatch","set","onChildAdded","ss","add","onChildChanged","edit","onChildRemoved","remove","on","off","unset","onValue","value","newValue","once","then","setupPaths","paths","all","cleanupPaths","usFn","next","setupPublicPaths","initSetupPaths","onAuthStateChanged","user","toJSON","setupPrivatePaths","undefined","prototype","hasOwnProperty","call","dbJobs","oldState","newState","method","child","result"],"mappings":"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","file":"firebase-redux-middleware.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"firebaseReduxMiddleware\"] = factory();\n\telse\n\t\troot[\"firebaseReduxMiddleware\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2f789b07382e1f104cae","const DB_ACTION_KEY = '__DB_ACTION__';\n\nconst logError = (...args) => {\n  console.error('[Firebase middleware]', ...args); // eslint-disable-line no-console\n};\n\nconst isEqual = (obj1, obj2) => {\n  if (\n    obj1 == null ||\n    obj2 == null ||\n    typeof obj1 !== 'object' ||\n    typeof obj2 !== 'object'\n  ) return obj1 === obj2;\n\n  if (Array.isArray(obj1) !== Array.isArray(obj2)) return false;\n\n  return Object.keys(obj1).reduce((isEq, key) => isEq && isEqual(obj1[key], obj2[key]), true);\n};\n\nconst getDeepData = (data, path = []) => {\n  if (data == null || typeof data !== 'object' || !path.length) return data;\n\n  let key = path.slice(0, 1)[0];\n  if (/^\\d+$/.test(key)) key = parseInt(key, 10);\n\n  return getDeepData(data[key], path.slice(1));\n};\n\nconst parseSnapshot = (snapshot) => {\n  const list = [];\n\n  snapshot.forEach((childSnapshot) => {\n    list.push({\n      id: childSnapshot.key,\n      ...childSnapshot.val(),\n    });\n  });\n\n  return list;\n};\n\nconst getDifference = (oldData, newData) =>\n  newData.reduce((changes, item) => {\n    const newChanges = Object.assign({}, changes);\n\n    const oldItem = oldData.find(({ id }) => id === item.id);\n    const newItem = Object.assign({}, item);\n\n    if (oldItem) {\n      newChanges.removed = newChanges.removed.filter(({ id }) => id !== oldItem.id);\n\n      if (!isEqual(oldItem, newItem)) newChanges.edited = newChanges.edited.concat([newItem]);\n    } else {\n      newChanges.added = newChanges.added.concat([newItem]);\n    }\n\n    return newChanges;\n  }, {\n    added: [],\n    edited: [],\n    removed: oldData.slice(),\n  });\n\nconst addIdToActionData = (action, data, id) => {\n  let found = false;\n\n  if (Array.isArray(action)) {\n    return action.map((actionData) => {\n      if (!found && isEqual(actionData, data)) {\n        found = true;\n\n        return {\n          id,\n          ...data,\n        };\n      }\n      if (!found && actionData != null && typeof actionData === 'object') {\n        return addIdToActionData(actionData, data, id);\n      }\n      return actionData;\n    });\n  }\n\n  return Object.keys(action).reduce((newAction, key) => {\n    if (!found && isEqual(action[key], data)) {\n      found = true;\n\n      return {\n        ...newAction,\n        [key]: {\n          id,\n          ...data,\n        },\n      };\n    }\n    if (!found && action[key] != null && typeof action[key] === 'object') {\n      return {\n        ...newAction,\n        [key]: addIdToActionData(action[key], data, id),\n      };\n    }\n    return {\n      ...newAction,\n      [key]: action[key],\n    };\n  }, {});\n};\n\nexport default (config, pathOptsArr) => {\n  const {\n    firebase,\n    reducer,\n    privatePath,\n    authActions = {},\n    onInited = () => {},\n  } = config;\n\n  const auth = firebase.auth();\n  const database = firebase.database();\n\n  const publicPathOpts = pathOptsArr.filter(({ isPrivate }) => !isPrivate);\n  const privatePathOpts = pathOptsArr.filter(({ isPrivate }) => isPrivate);\n\n  let inited = false;\n  let currentUser;\n  let unsubscribeFns = [];\n\n  const getRefForPath = ({ fbPath, isPrivate }) => {\n    if (!isPrivate) return database.ref(fbPath);\n    if (!currentUser) return null;\n    return database.ref(`${privatePath}/${currentUser.uid}/${fbPath}`);\n  };\n\n  const getStateForPath = (state, { storePath }) =>\n    getDeepData(state, storePath.split('/'));\n\n  const findItemByIdForPath = (state, id, pathOpts) =>\n    getStateForPath(state, pathOpts).find((item) => item.id === id);\n\n  const dbAction = (action, data) => ({\n    ...action(data),\n    [DB_ACTION_KEY]: true,\n  });\n\n  const setupPath = (pathOpts, store) => {\n    const { isPrivate, actions } = pathOpts;\n    const ref = getRefForPath(pathOpts);\n\n    const initState = getStateForPath(store.getState(), pathOpts);\n    if (!initState || typeof initState !== 'object') {\n      logError('Path skipped, because no initial state found', pathOpts);\n      return Promise.resolve(initState);\n    }\n\n    const onceValue = (snapshot) => {\n      let data;\n\n      if (Array.isArray(initState)) {\n        data = parseSnapshot(snapshot);\n        if (data.length) store.dispatch(dbAction(actions.set, data));\n\n        const onChildAdded = (ss) => {\n          const item = findItemByIdForPath(store.getState(), ss.key, pathOpts);\n          if (!item) store.dispatch(dbAction(actions.add, { id: ss.key, ...ss.val() }));\n        };\n\n        const onChildChanged = (ss) => {\n          const item = findItemByIdForPath(store.getState(), ss.key, pathOpts);\n          const newItem = { id: ss.key, ...ss.val() };\n          if (!isEqual(item, newItem)) store.dispatch(dbAction(actions.edit, newItem));\n        };\n\n        const onChildRemoved = (ss) => {\n          const item = findItemByIdForPath(store.getState(), ss.key, pathOpts);\n          if (item) store.dispatch(dbAction(actions.remove, { id: ss.key }));\n        };\n\n        ref.on('child_added', onChildAdded);\n        ref.on('child_changed', onChildChanged);\n        ref.on('child_removed', onChildRemoved);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('child_added', onChildAdded);\n            ref.off('child_changed', onChildChanged);\n            ref.off('child_removed', onChildRemoved);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      } else {\n        data = snapshot.val();\n        if (data) store.dispatch(dbAction(actions.set, data));\n\n        const onValue = (ss) => {\n          const value = getStateForPath(store.getState(), pathOpts);\n          const newValue = ss.val() || {};\n          if (!isEqual(value, newValue)) store.dispatch(dbAction(actions.set, newValue));\n        };\n\n        ref.on('value', onValue);\n\n        if (isPrivate) {\n          unsubscribeFns.push(() => {\n            ref.off('value', onValue);\n\n            store.dispatch(dbAction(actions.unset));\n          });\n        }\n      }\n\n      return data;\n    };\n\n    return ref.once('value')\n      .then(onceValue);\n  };\n\n  const setupPaths = (paths, store) =>\n    Promise.all(paths.map((pathOpts) => setupPath(pathOpts, store)));\n\n  const cleanupPaths = () => {\n    unsubscribeFns.forEach((usFn) => usFn());\n    unsubscribeFns = [];\n  };\n\n  return (store) => (next) => {\n    const setupPublicPaths = setupPaths(publicPathOpts, store);\n    const initSetupPaths = [\n      setupPublicPaths,\n    ];\n\n    auth.onAuthStateChanged((user) => {\n      if (user) {\n        currentUser = user;\n        if (authActions.set) store.dispatch(authActions.set(user.toJSON()));\n\n        const setupPrivatePaths = setupPaths(privatePathOpts, store);\n        if (!inited) initSetupPaths.push(setupPrivatePaths);\n      } else {\n        currentUser = undefined;\n        if (authActions.unset) store.dispatch(authActions.unset());\n\n        cleanupPaths();\n      }\n\n      if (!inited) {\n        inited = true;\n        Promise.all(initSetupPaths).then(() => onInited());\n      }\n    });\n\n    return (action) => {\n      if (Object.prototype.hasOwnProperty.call(action, DB_ACTION_KEY)) return next(action);\n\n      let newAction;\n      const dbJobs = [];\n      const oldState = store.getState();\n      const newState = reducer(oldState, action);\n\n      pathOptsArr.forEach((pathOpts) => {\n        const oldData = getStateForPath(oldState, pathOpts);\n        if (!oldData) return;\n\n        const newData = getStateForPath(newState, pathOpts);\n\n        if (Array.isArray(oldData)) {\n          const { added, edited, removed } = getDifference(oldData, newData);\n\n          added.forEach((data) => {\n            const ref = getRefForPath(pathOpts).push();\n\n            newAction = addIdToActionData(newAction || action, data, ref.key);\n            dbJobs.push({\n              ref,\n              method: 'set',\n              data,\n            });\n          });\n\n          edited.forEach(({ id, ...data }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'update',\n              data,\n            });\n          });\n\n          removed.forEach(({ id }) => {\n            dbJobs.push({\n              ref: getRefForPath(pathOpts).child(id),\n              method: 'remove',\n            });\n          });\n        } else if (!isEqual(oldData, newData)) {\n          dbJobs.push({\n            ref: getRefForPath(pathOpts),\n            method: 'set',\n            data: newData,\n          });\n        }\n      });\n\n      const result = next(newAction || action);\n\n      dbJobs.forEach(({ ref, method, data }) => {\n        ref[method](data);\n      });\n\n      return result;\n    };\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}